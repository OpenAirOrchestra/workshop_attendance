(this.webpackJsonptake_attendance=this.webpackJsonptake_attendance||[]).push([[0],{18:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(13),c=n.n(a),s=(n(18),n(1)),i=n.n(s),o=n(5),u=n(4),d=n(3),l=n(8),j=n(9),f={attendanceService:null,eventService:null,userService:null},b=n(6),h=n(7),p=function(){function e(){Object(b.a)(this,e)}return Object(h.a)(e,[{key:"serviceLocation",value:function(){return"../../../../?rest_route=/workshop_attendance/v1/attendees"}},{key:"retrieve",value:function(){var e=Object(d.a)(i.a.mark((function e(t,n,r){var a,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new URLSearchParams({page:t,per_page:n}),r&&a.set("search",r),c=this.serviceLocation()+"&"+a.toString(),e.next=5,fetch(c);case 5:if((s=e.sent).ok){e.next=8;break}throw new Error("Failed to get attendees Response: "+s.status+" "+s.statusText);case 8:return e.abrupt("return",s.json());case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.serviceLocation()+"/"+t,e.next=3,fetch(n);case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Failed to get attendee Response: "+r.status+" "+r.statusText);case 6:return e.abrupt("return",r.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.serviceLocation(),e.next=3,fetch(n,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Failed to create attendance record Response: "+r.status+" "+r.statusText);case 6:return e.abrupt("return",r.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.serviceLocation()+"/"+t,e.next=3,fetch(n,{method:"DELETE",mode:"cors"});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Failed to delete attendees Response: "+r.status+" "+r.statusText);case 6:return e.abrupt("return",Promise.resolve(r));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),v=p,O=function(){function e(){Object(b.a)(this,e)}return Object(h.a)(e,[{key:"serviceLocation",value:function(){return"../../../../?rest_route=/workshop_attendance/v1/events"}},{key:"retrieve",value:function(){var e=Object(d.a)(i.a.mark((function e(t,n,r){var a,c,s,o,u,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new URLSearchParams({page:t,per_page:n}),r&&(c=r.getTimezoneOffset(),s=new Date(r.getTime()-60*c*1e3),o=s.toISOString().substring(0,10),a.set("search",o)),u=this.serviceLocation()+"&"+a.toString(),e.next=5,fetch(u);case 5:if((d=e.sent).ok){e.next=8;break}throw new Error("Failed to get workshops Response: "+d.status+" "+d.statusText);case 8:return e.abrupt("return",d.json());case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.serviceLocation()+"/"+t,e.next=3,fetch(n);case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Failed to get workshop Response: "+r.status+" "+r.statusText);case 6:return e.abrupt("return",r.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.serviceLocation(),e.next=3,fetch(n,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("Failed to create workshop Response: "+r.status+" "+r.statusText);case 6:return e.abrupt("return",r.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),m=O,x=function(){function e(){Object(b.a)(this,e)}return Object(h.a)(e,[{key:"serviceLocation",value:function(){return"../../../../?rest_route=/wp/v2/users"}},{key:"retrieve",value:function(){var e=Object(d.a)(i.a.mark((function e(t,n){var r,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new URLSearchParams({page:t,per_page:n}),a=this.serviceLocation()+"&"+r.toString(),e.next=4,fetch(a);case 4:if((c=e.sent).ok){e.next=7;break}throw new Error("Failed to list users Response: "+c.status+" "+c.statusText);case 7:return e.abrupt("return",c.json());case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),w=x,g=n(0),k=function(e){var t=e.name,n=e.url,r=Object(g.jsx)("h1",{children:"Loading..."});t&&(r=Object(g.jsxs)("h1",{children:[">Attendance for ",t]}));n&&t&&(r=Object(g.jsxs)("h1",{children:["Attendance for ",Object(g.jsx)("a",{href:n,children:t})]}));return Object(g.jsx)("div",{className:"Header",children:r})};var y=function(e){var t=e.searchTerm,n=e.setSearchTerm,r=e.filterRecent,a=e.setFilterRecent,c=e.filterOld,s=e.setFilterOld,i=e.filterNew,o=e.setFilterNew,u=e.filterPresent,d=e.setFilterPresent;return Object(g.jsx)("div",{className:"SearchBar",children:Object(g.jsxs)("form",{children:[Object(g.jsx)("input",{type:"text",name:"search",placeholder:"\ud83d\udd0d",value:t,onChange:function(e){return n(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("input",{type:"checkbox",name:"recent",id:"recent",checked:!!r,onChange:function(e){return a(e.target.checked)}}),Object(g.jsx)("label",{htmlFor:"recent",children:"recent"}),Object(g.jsx)("input",{type:"checkbox",name:"old",id:"old",checked:!!c,onChange:function(e){return s(e.target.checked)}}),Object(g.jsx)("label",{htmlFor:"old",children:"rusty"}),Object(g.jsx)("input",{type:"checkbox",name:"new",id:"new",checked:!!i,onChange:function(e){return o(e.target.checked)}}),Object(g.jsx)("label",{htmlFor:"new",children:"new folks"}),Object(g.jsx)("input",{type:"checkbox",name:"attendees",id:"attendees",checked:!!u,onChange:function(e){return d(e.target.checked)}}),Object(g.jsx)("label",{htmlFor:"attendees",children:"attendees"})]})})};var S=function(e){var t=e.attendee,n=e.pendingMap?e.pendingMap:{},r=e.event_id,a=e.addAttendanceRecord,c=e.deleteAttendanceRecord,s=_(t),i=n[s],o=t.event_id&&t.event_id===r,u=t.notes?Object(g.jsxs)("div",{children:[" ",t.notes," "]}):"",d=t.phone?Object(g.jsxs)("span",{children:[" ",t.phone," "]}):"",l=t.email?Object(g.jsxs)("span",{children:[" ",t.email," "]}):"",j=o?"\u2714":"\u274c",f=o?"present":"absent",b=i?"pending":"",h=Object(g.jsxs)("div",{children:[u,l,d]}),p=i?Object(g.jsx)("span",{className:"pending-spinner"}):"",v=t.user_id&&t.lastname?t.lastname.charAt(0):t.lastname;return Object(g.jsxs)("tr",{className:"AttendanceRecord  "+f+" "+b,onClick:function(){o&&!i?c(t):i||a(t)},children:[Object(g.jsxs)("td",{className:"attendee",children:[t.firstname+" "+v,Object(g.jsx)("div",{className:"details",children:h})]}),Object(g.jsxs)("td",{className:"presence",children:[p,Object(g.jsx)("span",{className:"presenceIcon",children:j})]})]})};function _(e){var t=e.user_id;return t&&"0"!==t||(t=e.firstname+"."+e.lastname),t}var L=function(e){var t=e.attendees,n=e.pendingMap?e.pendingMap:{},r=e.event_id,a=e.addAttendanceRecord,c=e.deleteAttendanceRecord,s=t.sort((function(e,t){var n=e.firstname.toLowerCase(),r=t.firstname.toLowerCase();if(n.toLowerCase()>r.toLowerCase())return 1;if(n.toLowerCase()<r.toLowerCase())return-1;var a=e.lastname?e.lastname.toLowerCase():"",c=t.lastname?t.lastname.toLowerCase():"";return a.toLowerCase()>c.toLowerCase()?1:a.toLowerCase()<c.toLowerCase()?-1:0})).map((function(e){return Object(g.jsx)(S,{attendee:e,event_id:r,pendingMap:n,addAttendanceRecord:a,deleteAttendanceRecord:c},_(e))}));return Object(g.jsx)("div",{className:"AttendanceList",children:Object(g.jsx)("table",{children:Object(g.jsx)("tbody",{children:s})})})};var R=function(e){var t=e.hideAttendeeForm,n=e.addAttendanceRecord,a=Object(r.useState)(""),c=Object(u.a)(a,2),s=c[0],i=c[1],o=Object(r.useState)(""),d=Object(u.a)(o,2),l=d[0],j=d[1],f=Object(r.useState)(""),b=Object(u.a)(f,2),h=b[0],p=b[1],v=Object(r.useState)(""),O=Object(u.a)(v,2),m=O[0],x=O[1],w=Object(r.useState)(""),k=Object(u.a)(w,2),y=k[0],S=k[1];if(t)return null;return Object(g.jsxs)("div",{className:"NewAttendeeForm",children:[Object(g.jsx)("h2",{children:"Add New Attendee"}),Object(g.jsxs)("form",{action:"",children:[Object(g.jsx)("label",{htmlFor:"firstname",children:"First Name (required):"}),Object(g.jsx)("input",{type:"text",name:"firstname",id:"firstname",className:"required",value:s,onChange:function(e){return i(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("label",{htmlFor:"lastname",children:"Last Name (required): "}),Object(g.jsx)("input",{type:"text",name:"lastname",id:"lastname",className:"required",value:l,onChange:function(e){return j(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("label",{htmlFor:"email",children:"Email:"}),Object(g.jsx)("input",{type:"text",name:"email",id:"email",value:h,onChange:function(e){return p(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("label",{htmlFor:"phone",children:"Phone:"}),Object(g.jsx)("input",{type:"text",name:"phone",id:"phone",value:m,onChange:function(e){return x(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("label",{htmlFor:"notes",children:"Notes:"}),Object(g.jsx)("br",{}),Object(g.jsx)("textarea",{name:"notes",id:"notes",value:y,onChange:function(e){return S(e.target.value)}}),Object(g.jsx)("br",{}),Object(g.jsx)("div",{className:"centered",children:Object(g.jsx)("input",{type:"submit",value:"Add",disabled:!(s&&l),onClick:function(){!function(e,t,n,r,a,c,s,i,o,u,d,l){e({firstname:t,lastname:r,email:c,phone:i,notes:u}),n(""),a(""),s(""),o(""),d("")}(n,s,i,l,j,h,p,m,x,y,S)}})})]})]})};var F=function(e){if(!e.isLoading)return null;return Object(g.jsx)("div",{className:"Loading",children:Object(g.jsx)("div",{className:"inner",children:Object(g.jsx)("div",{className:"spinner"})})})};var N=function(e){var t,n=Object(r.useState)(0),a=Object(u.a)(n,2),c=a[0],s=a[1],i=Object(r.useState)(!0),o=Object(u.a)(i,2),d=o[0],f=o[1],b=Object(r.useState)(""),h=Object(u.a)(b,2),p=h[0],v=h[1],O=Object(r.useState)(!1),m=Object(u.a)(O,2),x=m[0],w=m[1],S=Object(r.useState)(!1),N=Object(u.a)(S,2),C=N[0],E=N[1],q=Object(r.useState)(!1),I=Object(u.a)(q,2),J=I[0],U=I[1],z=Object(r.useState)(!1),B=Object(u.a)(z,2),H=B[0],W=B[1],G=Object(r.useState)(null),K=Object(u.a)(G,2),Q=K[0],V=K[1],X=Object(r.useState)([]),Y=Object(u.a)(X,2),Z=Y[0],$=Y[1],ee=Object(r.useState)([]),te=Object(u.a)(ee,2),ne=te[0],re=te[1],ae=Object(r.useState)(null),ce=Object(u.a)(ae,2),se=ce[0],ie=ce[1],oe=Object(r.useState)([]),ue=Object(u.a)(oe,2),de=ue[0],le=ue[1],je=Object(r.useState)([]),fe=Object(u.a)(je,2),be=fe[0],he=fe[1],pe=Object(r.useState)(null),ve=Object(u.a)(pe,2),Oe=ve[0],me=ve[1],xe={},we=Object(j.a)(be);try{for(we.s();!(t=we.n()).done;){var ge=t.value,ke=_(ge);xe[ke]=ge}}catch(Re){we.e(Re)}finally{we.f()}Object(r.useEffect)((function(){D()})),Object(r.useEffect)((function(){c||function(e){M.apply(this,arguments)}(s)}),[c]),Object(r.useEffect)((function(){d&&c&&function(e,t,n,r,a,c,s){A.apply(this,arguments)}(c,f,V,$,re,ie,le)}),[d,c]);var ye=function(e,t){var n=t?t.toLowerCase().replace(/\s+/g,""):null,r=e;n&&(r=r.filter((function(e){return Object.values(e).map((function(e){return String(e).toLowerCase()})).join().replace(/\s+/g,"").includes(n)})));return r}(function(e,t,n,r,a){var c,s={},i=Object(j.a)(t);try{for(i.s();!(c=i.n()).done;){var o=c.value,u={user_id:o.id,firstname:"",lastname:""};o.nickname?u.firstname=o.nickname:o.first_name?(u.firstname=o.first_name,o.last_name&&(u.lastname=o.last_name)):o.name&&(u.firstname=o.name),o.description&&(u.notes=o.description),s[o.id]=u}}catch(Re){i.e(Re)}finally{i.f()}var d,f=Object(j.a)(n);try{for(f.s();!(d=f.n()).done;){var b=d.value;if(b.event_id!==e){var h=_(b),p=s[h];(p=p?Object(l.a)({},p):Object(l.a)({},b)).id=b.id,p.notes||(p.notes=b.notes),p.event_id=b.event_id,s[h]=p}}}catch(Re){f.e(Re)}finally{f.f()}var v,O=Object(j.a)(r);try{for(O.s();!(v=O.n()).done;){var m=v.value,x=_(m),w=s[x];(w=w?Object(l.a)({},w):Object(l.a)({},m)).id=m.id,w.event_id=m.event_id,m.phone&&!w.phone&&(w.phone=m.phone),m.user_id&&!w.user_id&&(w.user_id=m.user_id),m.user_id&&!w.user_id&&(w.user_id=m.user_id),m.firstname&&!w.firstname&&(w.firstname=m.firstname),m.lastname&&!w.lastname&&(w.lastname=m.lastname),m.notes&&!w.notes&&(w.notes=m.notes),s[x]=w}}catch(Re){O.e(Re)}finally{O.f()}var g,k=Object(j.a)(a);try{for(k.s();!(g=k.n()).done;){var y=g.value,S=_(y),L=s[S];L=L?Object(l.a)({},L):Object(l.a)({},y),s[S]=L}}catch(Re){k.e(Re)}finally{k.f()}var R=Object.values(s);return R||[]}(c,Z,ne,de,be),p),Se=function(e,t,n,r,a,c,s){var i=t;(r||c||a||s)&&(i=i.filter((function(t){if(c&&(!t.user_id||"0"===t.user_id))return!0;if(s&&t.event_id&&t.event_id===e)return!0;if(r||a){var i=_(t),o=n.has(i);if(r&&o)return!0;if(a&&!o)return!0}return!1})));return i}(c,ye,se,x,C,J,H),_e=!d&&(J||H||!x),Le=c?"../../../../wp-admin/admin.php?page=workshop&workshop="+c:null;return Object(g.jsxs)("div",{className:"AttendanceSheet",children:[Object(g.jsx)(k,{name:Q?Q.title:"",url:Le}),Object(g.jsx)(y,{searchTerm:p,setSearchTerm:v,filterRecent:x,setFilterRecent:w,filterOld:C,setFilterOld:E,filterNew:J,setFilterNew:U,filterPresent:H,setFilterPresent:W}),Object(g.jsx)(L,{attendees:Se,event_id:c,pendingMap:xe,addAttendanceRecord:function(e){me(T(c,e,Oe,be,he,le))},deleteAttendanceRecord:function(e){me(function(e,t,n,r,a,c,s){return P.apply(this,arguments)}(c,e,Oe,be,he,re,le))}}),Object(g.jsx)(R,{hideAttendeeForm:!_e,addAttendanceRecord:function(e){me(T(c,e,Oe,be,he,le))}}),Object(g.jsx)(F,{isLoading:d})]})};function C(e){window.confirm(e+"\nReload?")&&window.location.reload()}function A(){return(A=Object(d.a)(i.a.mark((function e(t,n,r,a,c,s,u){var d,l,b,h,p,v,O,m,x,w,g,k,y,S,L,R,F;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d=f.eventService,l=f.userService,b=f.attendanceService,e.next=6,d.get(t);case 6:h=e.sent,r(h),p=1,v=[],O=!0;case 11:return e.next=13,l.retrieve(p,100);case 13:m=e.sent,v=[].concat(Object(o.a)(v),Object(o.a)(m)),a(v),O=m.length>0,++p;case 18:if(O){e.next=11;break}case 19:return e.next=21,b.retrieve(1,50);case 21:x=e.sent,c(x),w=new Set,g=Object(j.a)(x);try{for(g.s();!(k=g.n()).done;)y=k.value,S=_(y),w.add(S)}catch(i){g.e(i)}finally{g.f()}s(w),p=1,L=[],R=!0;case 30:return e.next=32,b.retrieve(p,100,t);case 32:F=e.sent,L=[].concat(Object(o.a)(L),Object(o.a)(F)),u(L),R=F.length>0,++p;case 37:if(R){e.next=30;break}case 38:n(!1),e.next=44;break;case 41:e.prev=41,e.t0=e.catch(0),C(e.t0);case 44:case"end":return e.stop()}}),e,null,[[0,41]])})))).apply(this,arguments)}function T(e,t,n,r,a,c){return E.apply(this,arguments)}function E(){return(E=Object(d.a)(i.a.mark((function e(t,n,r,a,c,s){var u,d,j,b,h,p,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=f.attendanceService,(d=Object(o.a)(a)).push(n),c(d),u.pendingRecords=d,(j=Object(l.a)({},n)).event_id=t,j.id=void 0,e.next=11,u.create(j);case 11:return e.next=13,r;case 13:b=1,h=[],p=!0;case 16:return e.next=18,u.retrieve(b,100,t);case 18:v=e.sent,h=[].concat(Object(o.a)(h),Object(o.a)(v)),s(h),p=v.length>0,++b;case 23:if(p){e.next=16;break}case 24:d=Object(o.a)(u.pendingRecords).filter((function(e){return e!==n})),c(d),u.pendingRecords=d,Promise.resolve(n),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),C(e.t0);case 33:case"end":return e.stop()}}),e,null,[[0,30]])})))).apply(this,arguments)}function P(){return(P=Object(d.a)(i.a.mark((function e(t,n,r,a,c,s,u){var d,l,j,b,h,p,v,O;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d=f.attendanceService,(l=Object(o.a)(a)).push(n),c(l),d.pendingRecords=l,j=n.id,e.next=9,d.delete(j);case 9:return e.next=11,r;case 11:return e.next=13,d.retrieve(1,50);case 13:b=e.sent,s(b),h=1,p=[],v=!0;case 18:return e.next=20,d.retrieve(h,100,t);case 20:O=e.sent,p=[].concat(Object(o.a)(p),Object(o.a)(O)),u(p),v=O.length>0,++h;case 25:if(v){e.next=18;break}case 26:l=Object(o.a)(d.pendingRecords).filter((function(e){return e!==n})),c(l),d.pendingRecords=l,Promise.resolve(n),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(0),C(e.t0);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})))).apply(this,arguments)}function D(){f.userService||(f.eventService=new m,f.userService=new w,f.attendanceService=new v)}function M(){return(M=Object(d.a)(i.a.mark((function e(t){var n,r,a,c,s,o,u,d,l,j,b,h,p,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(n=null)||(r=window.location.search,a=new URLSearchParams(r),n=a.get("event_id")),n){e.next=11;break}return D(),c=f.eventService,e.next=9,c.retrieve(1,100,new Date);case 9:1===(s=e.sent).length&&(n=s[0].id);case 11:if(n){e.next=25;break}return D(),o=f.eventService,u=new Date,d=u.getTimezoneOffset(),l=new Date(u.getTime()-60*d*1e3),j=l.toISOString().substring(0,10),b=navigator.languages[0],h=l.toLocaleDateString(b,{weekday:"long"})+" Workshop "+l.toLocaleDateString(b,{day:"numeric",month:"long",year:"numeric"}),p={date:j,title:h},e.next=23,o.create(p);case 23:v=e.sent,n=v.id;case 25:return t(n),e.abrupt("return",Promise.resolve(n));case 29:e.prev=29,e.t0=e.catch(0),C(e.t0);case 32:case"end":return e.stop()}}),e,null,[[0,29]])})))).apply(this,arguments)}function q(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(N,{})})}c.a.render(Object(g.jsx)(q,{}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.68069cb2.chunk.js.map